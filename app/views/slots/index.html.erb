<div class="row" style="padding-bottom: 20px">
  <div class="col-lg-3">
    <%= link_to "Previous week", slots_path(:week => @week-1), :class => "btn btn-default col-lg-12", :disabled => @week == 0 %>
  </div>
  <div class="col-lg-6 text-center">
    <h4>
      <%= @time_slots.keys.first.strftime("%B %d, %Y") %> - <%= @time_slots.keys.last.strftime("%B %d, %Y") %>
    </h4>
  </div>
  <div class="col-lg-3">
    <%= link_to "Next week", slots_path(:week => @week+1), :class => "btn btn-default col-lg-12", :disabled => @week == 4 %>
  </div>
</div>

<div class="row">
  <div class="col-lg-12">
    <table class="table table-bordered small">
      <thead>
        <tr>
          <th></th>
          <% @time_slots[@time_slots.keys.first].each do |slot| %>
            <th>
              <span class="text-muted"><%= "#{slot.strftime("%H:%M")} - #{(slot+2.hours).strftime("%H:%M")}" %></span>
            </th>
          <% end %> 
        </tr>
      </thead>

      <tbody>
        <% @time_slots.each do |day,slots| %>
          <tr>
            <th>
              <span class="text-muted">
                <%= "#{day.strftime("%A")}" %><br/>
                <%= day %>  
              </span>
            </th>
            <% slots.each do |slot| %>
              <td class="<%= @booked_slots[slot].nil? && slot >= @current_time_slot ? "" : "active" %> text-center" style="vertical-align: middle">
                <% if slot < @current_time_slot %>
                <% elsif @booked_slots[slot].blank? %>
                  <% if current_user.slots.blank? %>
                    <%= link_to '<i class="fa fa-lock fa-lg" aria-hidden="true"></i>'.html_safe, slots_path(:start => slot, :finish => slot + 2.hours), :class => "btn btn-default", :method => :post %>
                  <% end %>
                <% elsif @booked_slots[slot].user == current_user %>
                  <%= link_to '<i class="fa fa-unlock-alt fa-lg" aria-hidden="true"></i>'.html_safe, slot_path(@booked_slots[slot]), :class => "btn btn-default", :method => :delete %>
                <% else %>
                  <span class="text-muted"><h5><%= @booked_slots[slot].room_number %></h5></span>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>     
      </tbody>
    </table>
  </div>
</div>

<% if current_user.slots.length > 0 %>
  <div class="row">
    <div class="col-lg-12">
      <div class="alert alert-info">
        <h4>Booked slot</h4>
        <p><%= current_user.slots.first.start.localtime.strftime("%B %d, %Y (%A)") %></p>
        <p><%= "#{current_user.slots.first.start.localtime.strftime("%H:%M")} - #{current_user.slots.first.finish.localtime.strftime("%H:%M")}" %></p>
      </div>
    </div>
  </div>
<% end %>